# Home可视化卡片 (HomeVisualizationCard)

## 1. 模块概述

Home页面的主要可视化组件，实时显示频谱图、瀑布图和统计信息。

## 2. 显示内容

### 2.1 功率谱图 (上方)
- X轴：频率 (MHz)
- Y轴：功率 (dB)
- 实时更新的折线图

### 2.2 瀑布图 (中间)
- X轴：频率
- Y轴：时间（新数据在顶部）
- 颜色：Jet色图（蓝→绿→黄→红）

### 2.3 统计信息 (下方)
- 显示帧数
- 处理帧数
- 跳过帧数和丢帧率
- 最大值/最小值

## 3. 技术实现

### 3.1 频谱图绘制
```python
# 使用 QLineSeries
self.spectrum_series = QLineSeries()
for i, value in enumerate(spectrum_data):
    freq = center_freq - sample_rate/2 + i * freq_step
    self.spectrum_series.append(freq, value)
```

### 3.2 瀑布图绘制
```python
# NumPy数组 → 归一化 → 色图 → QImage → QPixmap
waterfall_array = self.data_processor.get_waterfall_array()
normalized = np.clip((waterfall_array - vmin) / (vmax - vmin) * 255, 0, 255)
colored_image = self.colormap[normalized]
qimage = QImage(colored_image.data, width, height, QImage.Format_RGB888)
pixmap = QPixmap.fromImage(qimage).scaled(...)
```

### 3.3 更新机制
```python
# 定时器驱动更新（40fps）
self.update_timer = QTimer()
self.update_timer.timeout.connect(self.update_visualization)
self.update_timer.start(25)  # 25ms
```

## 4. 性能优化

### 4.1 帧率控制
- 频谱图：每帧更新
- 瀑布图：每2帧更新
- 统计信息：每5帧更新

### 4.2 重复帧跳过
```python
if frame_id == self.last_frame_id:
    self.skip_count += 1
    return  # 不重复处理
```

### 4.3 快速缩放
```python
pixmap.scaled(..., Qt.TransformationMode.FastTransformation)
```

## 5. 色图预计算
```python
# 启动时预计算Jet色图
cmap = plt.get_cmap("jet")
self.colormap = (cmap(np.linspace(0, 1, 256))[:, :3] * 255).astype(np.uint8)
```

## 6. 与其他模块的接口

### 6.1 输入
- **DataProcessor.get_latest_spectrum()**: 获取频谱数据
- **DataProcessor.get_waterfall_array()**: 获取瀑布图数组
- **DataProcessor.get_stats()**: 获取统计信息

### 6.2 配置
- **update_config()**: 更新频率轴配置